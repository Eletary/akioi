# 普通计算姬 题解

序列分块。对于每一个块预处理出其答案。

考虑修改时对每一个块的贡献。因为每个点只对它祖先的答案有贡献，所以我们可以遍历整棵树，开一个桶记录当前每一个块的数个数。遍历到 x 时，将该桶的内容就是 x 对每个块的贡献，记录下来即可。这样修改时统计每个块 sum 加了多少就是贡献乘值的变化。

查询时整块加起来，散块暴力求出每个点的子树和。

显然我们需要一个数据结构维护 dfs 序上的单点加区间求和。

考虑根号平衡，分块维护前缀和数组，这样单点加就相当于后缀加，区间查询就相当于单点查询。

如此，显然块长均取 $\sqrt{n}$ 最优，修改、查询复杂度为 $O(\sqrt{n})$，总复杂度 $O(n\sqrt{n})$。

代码先咕，后面补。