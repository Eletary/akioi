# Ynoi 题目记叙

由于 Ynoi 是十分经典、十分重要的数据结构题目，这里特别列出。

## [[Ynoi2018] 五彩斑斓的世界 / 第二分块](https://www.luogu.com.cn/problem/P4117)

思路：对序列进行分块。每个块内维护值域并查集，每次将大于 $x$ 的 $y$ 合并到 $y-x$ 上，零散块暴力重构。

优化：观察到 $mx$ 单调不增。设 $mx$ 为块内最大值。对于每个 $x$，如果 $mx>2x$，则改为将 $y\leq x$ 合并到 $y+x$ 上，然后打上全局减的标记。摊还复杂度 $O(1)$。总复杂度 $O((V+m)B)$（$V$ 为值域，$B$ 为块长）。

优化：每个块对询问的贡献/修改都是独立的。考虑离线然后对每个块单独处理，空间复杂度由 $O(VB)$ 降为 $O(n+B)$。

由于 $n,m,V$ 同阶，取 $B=\sqrt{n}$，时间复杂度为 $O(n\sqrt{n})$，空间复杂度 $O(n)$，可以通过。

注意：打标记后什么时候加标记、什么时候不加容易弄混。因为标记是全局减，数据会整体向上偏移，注意超过数组上界时暴力重构。