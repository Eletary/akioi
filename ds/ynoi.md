# Ynoi 题目记叙

由于 Ynoi 是十分经典、十分重要的数据结构题目，这里特别列出。

## [Ynoi2018] 五彩斑斓的世界

[Link](https://www.luogu.com.cn/problem/P4117)

第二分块。

思路：对序列进行分块。每个块内维护值域并查集，每次将大于 $x$ 的 $y$ 合并到 $y-x$ 上，零散块暴力重构。

优化：设 $mx$ 为块内最大值。观察到 $mx$ 单调不增。对于每个 $x$，如果 $mx>2x$，则改为将 $y\leq x$ 合并到 $y+x$ 上，然后打上全局减的标记。摊还复杂度 $O(1)$。总复杂度 $O((V+m)B)$（$V$ 为值域，$B$ 为块长）。

优化：每个块对询问的贡献/修改都是独立的。考虑离线然后对每个块单独处理，空间复杂度由 $O(VB)$ 降为 $O(n+B)$。

由于 $n,m,V$ 同阶，取 $B=\sqrt{n}$，时间复杂度为 $O(n\sqrt{n})$，空间复杂度 $O(n)$，可以通过。

注意：打标记后什么时候加标记、什么时候不加容易弄混。因为标记是全局减，数据会整体向上偏移，注意超过数组上界时暴力重构。

## [Ynoi2014] 等这场战争结束之后

[Link](https://www.luogu.com.cn/problem/P5064)

思路：离线 DFS 操作树来处理版本问题，开并查集（有回溯，不能路径压缩）处理集合，每个点维护其值域。查询找到相应的根，在值域上二分即可。复杂度 $O((n+m)\log n)$（值域离散化），空间 $O(n^2)$。

优化：将值域信息为块状数组，时空复杂度均为 $O(nB)$（$n$、$m$ 同阶）。取 $B=40$ 且值域数组开为 `short`，此时单块最多 $n/B=2.5\times 10^3$，未爆 `short`，且时空均满足。可以通过。

注意：块要填满，不能 `1~n` 直接除。